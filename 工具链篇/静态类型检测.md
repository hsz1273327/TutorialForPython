# `*`ç±»å‹æ³¨é‡Šå’Œæ£€éªŒ

python3.5èµ·pythonæä¾›äº†ç±»å‹æ ‡æ³¨æ”¯æŒ([pep 484](https://peps.python.org/pep-0484/)).ä¹‹åçš„æ¯ä¸ªç‰ˆæœ¬å‡ ä¹éƒ½æœ‰å¯¹è¿™ä¸€ç‰¹æ€§çš„æ”¹è¿›.åˆ°äº†python3.10ç±»å‹æ ‡æ³¨è¿™ä¸€ç‰¹æ€§å·²ç»åŸºæœ¬ç¨³å®š.

***ps:ç±»å‹æ³¨é‡Šåªæ˜¯æ³¨é‡Š,pythonè§£é‡Šå™¨å¹¶ä¸ä¼šå¤„ç†å®ƒ,è¦è®©å®ƒæœ‰ç±»å‹æ£€éªŒçš„åŠŸèƒ½è¿˜è¦æœ‰å…¶ä»–å·¥å…·é…åˆ.***

é€šå¸¸å¦‚æœéœ€è¦ç”¨ä¸€äº›æ›´é«˜ç‰ˆæœ¬çš„ç±»å‹æ³¨é‡Šç‰¹æ€§,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[typing_extensions](https://pypi.org/project/typing-extensions/)è¿™ä¸ªåŒ…åšè¡¥å…….

## å£°æ˜ç±»å‹

ç›®å‰çš„ç±»å‹æ ‡æ³¨å¯ä»¥æ³¨é‡Š:

+ å‡½æ•°ç­¾å
+ å˜é‡


### å‡½æ•°ç­¾å

å‡½æ•°æ˜¯æœ€åŸºæœ¬çš„ç±»å‹å£°æ˜åœºæ™¯.å‡½æ•°çš„å‚æ•°ä½¿ç”¨`:`æŒ‡å®šç±»å‹,è¿”å›å€¼åˆ™ä½¿ç”¨`->`.éœ€è¦æ³¨æ„,lambdaå‡½æ•°æ— æ³•å£°æ˜å…¶ç­¾å,æˆ‘ä»¬åªèƒ½åœ¨ä¸ºæœŸç»‘å®šå˜é‡æ—¶å£°æ˜è¿™ä¸ªå˜é‡å¯¹åº”çš„ç­¾å

ä¸€ä¸ªæœ€åŸºç¡€çš„å‡½æ•°ç­¾åç»“æ„å¦‚ä¸‹:


```python
def func(arg:int)->int:
    return arg
```

### ä¿®é¥°æè¿°

pythonçš„å‡½æ•°æ˜¯å¾ˆçµæ´»çš„,å¯ä»¥æœ‰é»˜è®¤å€¼,å¯ä»¥ä¸ºNone,ä¹Ÿå¯ä»¥æœ‰å¤šç§å¯èƒ½çš„ç±»å‹.typingæä¾›äº†å¦‚ä¸‹å‡ ç§ä¿®é¥°æè¿°:

+ `Union`,ç”¨äºæè¿°`æˆ–`å…³ç³»,è¡¨ç¤ºè¿™ä¸ªè¢«å£°æ˜çš„å˜é‡å¯ä»¥å‡ ç§ä¹‹ä¸€.æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`|`ä½œä¸ºç®€å†™


```python
from typing import Union,Sequence
def handle_employees(e: Union[int, Sequence[int]]) -> None:
    if isinstance(e, Employee):
        e = [e]
```


```python
from typing import Union,Sequence
def handle_employees_s(e: int| Sequence[int]) -> None:
    if isinstance(e, Employee):
        e = [e]
```

+ `Optional`,ç›¸å½“äº`Union[ç±»å‹, None]]`,è¡¨ç¤ºè¿™ä¸ªå˜é‡å¯ä»¥ä¸ºç©º.


```python
from typing import Optional
def option_demo(x:int,y: Optional[int]=None) -> int:
    if y:
        return x+y
    else:
        return x
```

+ `NoReturn`,åªèƒ½ç”¨äºæè¿°è¿”å›å€¼,è¡¨ç¤ºè¿™ä¸ªå‡½æ•°æ°¸è¿œä¸ä¼šæœ‰è¿”å›å€¼,éœ€è¦æ³¨æ„çš„æ˜¯æ­£å¸¸å‡½æ•°ä¸å†™`return`ä¾ç„¶ä¼šè¿”å›`None`,`NoReturn`çš„ç¡®åˆ‡å«ä¹‰å…¶å®æ˜¯è¿™ä¸ªå‡½æ•°æ— è®ºå¦‚ä½•éƒ½ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯.


```python
from typing import NoReturn

def stop() -> NoReturn:
    raise RuntimeError('no way')
```

+ `overload`,å£°æ˜å‡½æ•°æˆ–æ–¹æ³•ä¼šé‡è½½å·²ç»å®šä¹‰çš„å‡½æ•°æˆ–æ–¹æ³•.`overload`æ˜¯ä¸€ä¸ªè£…é¥°å™¨.`@overload`è£…é¥°å™¨å¯ä»¥ä¿®é¥°æ”¯æŒå¤šä¸ªä¸åŒå‚æ•°ç±»å‹ç»„åˆçš„å‡½æ•°æˆ–æ–¹æ³•.`@overload`è£…é¥°å®šä¹‰çš„ä¸€ç³»åˆ—æ–¹æ³•æˆ–å‡½æ•°å¿…é¡»ç´§è·Ÿåœ¨ä¸€ä¸ªé`@overload`è£…é¥°å®šä¹‰çš„åŒåå‡½æ•°ä¹‹å.

    ```python
    from typing import overload
    @overload
    def process(response: None) -> None:
        ...
    @overload
    def process(response: int) -> tuple[int, str]:
        ...
    @overload
    def process(response: bytes) -> str:
        ...
    def process(response):
    ```

+ `final`,å£°æ˜è¢«è£…é¥°çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–,ä¸”è¢«è£…é¥°çš„ç±»ä¸èƒ½ä½œä¸ºå­ç±»çš„è£…é¥°å™¨.è¿™é€šå¸¸ç”¨äºåœ¨å®šä¹‰åŸºç±»æ—¶ä½¿ç”¨.

    ```python
    class Base:
        @final
        def done(self) -> None:
            ...
    class Sub(Base):
        def done(self) -> None:  # Error reported by type checker
            ...

    @final
    class Leaf:
        ...
    class Other(Leaf):  # Error reported by type checker
        ...
    ```

+ `*Never`[3.11],ç”¨äºä½œä¸ºå‡½æ•°çš„å‚æ•°,æè¿°è¿™ä¸ªå‡½æ•°ä¸è¯¥è¢«è°ƒç”¨,ä¸€èˆ¬ç”¨åœ¨è¿˜æ²¡å®ç°çš„å‡½æ•°ä¸Š

```python
rom typing import Never

def never_call_me(arg: Never) -> None:
    pass
```

### å˜é‡

ç±»å‹æ ‡æ³¨æ—¢å¯ä»¥æ ‡æ³¨æ¨¡å—ä¸­å¸¸é‡å…¨å±€å˜é‡,ä¹Ÿå¯ä»¥æ ‡æ³¨å‡½æ•°æ–¹æ³•ä¸­çš„å†…éƒ¨å˜é‡ä»¥åŠç±»ä¸­çš„å­—æ®µ.å˜é‡å£°æ˜ä½¿ç”¨`:`è¯­æ³•,å˜é‡åé¢æ¥`:`ç„¶åæ˜¯å£°æ˜çš„ç±»å‹,æˆ‘ä»¬ä¹Ÿå¯ä»¥å†åœ¨åé¢åŠ ä¸Š`= value`æ¥ç›´æ¥ä¸ºå…¶èµ‹ä¸ªåˆå€¼.


```python
CONST_A: int
CONST_B: int = 2
```


```python
def fn_a(c:int)-> int:
    a: int = 1
    b: int = 2
    return a+b+c
```


```python
from typing import ClassVar
class CLZ_A:
    captain: ClassVar[str] = 'Picard'# ç±»å±æ€§
    damage: int # å®ä¾‹å±æ€§

```

## è·å–ç±»å‹å£°æ˜

æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªå¯¹è±¡,é€šè¿‡è°ƒç”¨æ ‡å‡†åº“`inspect`ä¸­çš„`get_annotations(obj)`æ¥è·å–æ¨¡å—,å‡½æ•°,ç±»å…¶ä¸­çš„ç±»å‹å£°æ˜,éœ€è¦æ³¨æ„å†…éƒ¨å˜é‡çš„å£°æ˜æ— æ³•è·å–.


```python
import inspect
```


```python
inspect.get_annotations(fn_a)
```




    {'c': int, 'return': int}




```python
inspect.get_annotations(CLZ_A)
```




    {'captain': typing.ClassVar[str], 'damage': int}



## ç‰¹æ®Šç±»å‹

### Anyç±»å‹

Anyç±»å‹å’Œtsä¸­ä¸€æ ·,ä»£è¡¨ä»»æ„ç±»å‹éƒ½å¯ä»¥.


```python
from typing import Any
a: Any = 1
```

### AnyStrç±»å‹

AnyStrç›¸å½“äº`TypeVar('AnyStr', str, bytes)`,å®ƒå¯ä»¥ç”¨äºæè¿°å­—ç¬¦ä¸²ç±»å‹


```python
from typing import AnyStr
a: AnyStr = "æµ‹è¯•"
```

### Textç±»å‹

Textç±»å‹æ˜¯ç”¨äºå’Œpython2ä¸­è¿›è¡Œå…¼å®¹çš„ç±»å‹,åœ¨python3ä¸­æ˜¯`str`çš„åˆ«å,`Python 2`ä¸­æ˜¯`unicode`çš„åˆ«å.ç°åœ¨é™¤äº†è€æ—§ä»£ç ç»´æŠ¤å·²ç»åŸºæœ¬ç”¨ä¸åˆ°äº†.

### Literalç±»å‹

ç”¨äºæŒ‡å®šå˜é‡çš„å€¼ç­‰ä»·äºç»™å®šå­—é¢é‡(æˆ–å¤šä¸ªå­—é¢é‡ä¹‹ä¸€)çš„ç±»å‹.è¿™é€šå¸¸ç”¨åœ¨ç‰¹å®šé€‰é¡¹çš„æƒ…å†µä¸‹


```python
from typing import Literal

b: Literal["1","2","3"]
b = 3
```

### IOç±»å‹

ç”¨äºç”³æ˜å˜é‡æˆ–å‚æ•°æ˜¯ä¸€ä¸ªæ ‡å‡†åº“`io`ä¸­å®šä¹‰çš„I/Oæµçš„ç±»å‹.`typing.IO`æ˜¯ä¸€ä¸ªæ³›å‹ç±»,å®ƒæœ‰ä¸¤ä¸ªå®ä¾‹å­ç±»:

+ `typing.TextIO`å¯¹åº”`io.StringIO`åŠå¯¹åº”çš„å­—ç¬¦ä¸²ä¸ºå†…å®¹çš„å…¶ä»–æµ
+ `typing.BinaryIO`å¯¹åº”`io.BytesIO`åŠå¯¹åº”çš„å­—èŠ‚ä¸²ä¸ºå†…å®¹çš„å…¶ä»–æµ


```python
from typing import TextIO

inio: TextIO
```

### reç±»å‹

æ­£åˆ™è¡¨è¾¾å¼æ“ä½œä¸­ä½¿ç”¨çš„å¯¹åº”ç±»å‹,åˆ†ä¸º:

+ `typing.Pattern`å¯¹åº”`re.compile()`è¿”å›çš„ç±»å‹`re.Pattern`
+ `typing.Match`å¯¹åº”`re.match()`è¿”å›çš„ç±»å‹`re.Match`

è¿™ä¸ªç±»å‹çš„å£°æ˜å¯ä»¥ç›´æ¥ä½¿ç”¨`re`æ¨¡å—ä¸‹çš„å¯¹åº”ç±»å‹å®ç°,å‡å°‘å¯¹`typing`çš„å¼•ç”¨


```python
import re

rem: re.Match
```

### Typeç±»å‹

`Type[C]`æˆ–è€…`type[C]`è¡¨ç¤º`C`çš„ç±»å‹,è€Œ`C`æŒ‡ä»£ä¸€ä¸ªç‰¹å®šç±»å‹.ä¸¾ä¸ªä¾‹å­.`type(10)`çš„å­—é¢é‡æ˜¯`int`,å¦‚æœ`x = type(10)`é‚£ä¹ˆå°±å¯ä»¥è¿™æ ·å£°æ˜`x:type[int]`.

`Type[C]`æ˜¯ä¸€ä¸ªåå˜é‡(Covariant),ç±»å‹å‚æ•°çš„å…³ç³»æ»¡è¶³åå˜æ€§.åœ¨åå˜æ€§ä¸­å¦‚æœä¸€ä¸ªç±»å‹`A`æ˜¯å¦ä¸€ä¸ªç±»å‹`B`çš„å­ç±»å‹(æˆ–è€…å¯ä»¥çœ‹ä½œ`A`æ‹¥æœ‰`B`çš„æ‰€æœ‰è¡Œä¸ºå’Œèƒ½åŠ›),é‚£ä¹ˆæ³›å‹ç±»å‹å‚æ•°åœ¨`A`ä¸­ä½¿ç”¨æ—¶å¯ä»¥æ›¿æ¢ä¸º`B`.æ¢å¥è¯è¯´åå˜æ€§ä¿æŒäº†ç±»å‹å‚æ•°çš„å­ç±»å‹å…³ç³».

åå˜æ€§çš„å…³é”®ç‰¹æ€§æ˜¯--å¯ä»¥å°†å­ç±»å‹çš„å®ä¾‹èµ‹å€¼ç»™çˆ¶ç±»å‹çš„å¼•ç”¨,è€Œä¸ä¼šäº§ç”Ÿç±»å‹é”™è¯¯.è¿™åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥æä¾›æ›´çµæ´»çš„ç±»å‹ä½¿ç”¨å’Œæ›´å¥½çš„ä»£ç å¤ç”¨.

åˆ©ç”¨åå˜æ€§æˆ‘ä»¬å¯ä»¥ç”¨å®ƒå£°æ˜å¦‚ä¸‹å‡ ç§æƒ…å†µ:

+ ç±»æ–¹æ³•ä¸­çš„ç±»å˜é‡
    ```python
    class SelfTestClz:
        @classmethod
        def new_one(clz:type[Self])->Self:
            return clz()
    ```

+ å‚æ•°å¿…é¡»æ˜¯ç‰¹å®šç±»å­ç±»çš„çš„å®ä¾‹çš„æƒ…å†µ

```python
from flask.views import MethodView


class APIView:
    ...
    def register(self, url: str) -> Callable[[Type[MethodView]], Type[MethodView]]:
        def wrap(clz: Type[MethodView]) -> Type[MethodView]:
            self.restapi.add_url_rule(url, view_func=clz.as_view(clz.__name__))
            return clz
        return wrap
    ...
```


### `*[3.11]`Selfç±»å‹

å£°æ˜æ–¹æ³•æ—¶æ¯ä¸ªå®ä¾‹æ–¹æ³•éƒ½æœ‰ä¸€ä¸ª`self`å˜é‡,åœ¨`Python 3.11`ä¹‹å‰æˆ‘ä»¬è¦ä¹ˆä¸å£°æ˜ç±»å‹è¦ä¹ˆç”¨ç±»åçš„å­—é¢é‡å­—ç¬¦ä¸²æ¥å£°æ˜ç±»å‹,åœ¨`Python 3.11`ä¸­æ–°å¢äº†å ä½ç±»å‹`Self`å¯ä»¥ç”¨äºè¡¨ç¤ºå½“å‰æ‰€åœ¨çš„å®ä¾‹çš„ç±»å‹,å› æ­¤æˆ‘ä»¬å¯ä»¥åƒä¸‹é¢è¿™æ ·å£°æ˜ç±»ä¸­æ–¹æ³•äº†


```python
from typing_extensions import Self

class SelfTestClz:
    @classmethod
    def new_one(clz:type[Self])->Self:
        return clz()
    def __init__(self:Self)->None:
        pass
```

æ³¨æ„ç±»æ–¹æ³•ä¸­çš„clzå£°æ˜ä¸ºäº†`type[Self]`,å…¶å«ä¹‰æ˜¯`Self`æŒ‡ä»£çš„å®ä¾‹ç±»å‹çš„ç±»å‹

## å®¹å™¨ç±»å‹çš„ç”³æ˜


å®¹å™¨å¯ä»¥åˆ†ä¸ºå…·è±¡å®¹å™¨ç±»å‹å’ŒæŠ½è±¡å®¹å™¨ç±»å‹.
å…·è±¡å®¹å™¨ç±»å‹ä¼šé™åˆ¶æ­»ç‰¹å®šçš„å®¹å™¨,è€ŒæŠ½è±¡å®¹å™¨ç±»å‹åˆ™åªä¼šé™åˆ¶å®¹å™¨éœ€è¦æ»¡è¶³ç‰¹å®šæ¥å£.
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨typingä¸­çš„ç±»å‹æ¥ç”³æ˜ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å¯¹åº”å®¹å™¨çš„å·¥å‚å‡½æ•°æ¥ç”³æ˜,æ›´åŠ æ¨èä½¿ç”¨å¯¹åº”å®¹å™¨çš„å·¥å‚å‡½æ•°æ¥ç”³æ˜,è¿™æ ·å¯ä»¥å°‘importå¾ˆå¤šä¸œè¥¿,ä»£ç æ›´æ•´æ´.

### å…·è±¡å®¹å™¨ç±»å‹

typingä¸­çš„ç±»å‹|å¯¹åº”å®¹å™¨å·¥å‚å‡½æ•°|æ»¡è¶³çš„æŠ½è±¡å®¹å™¨ç±»å‹
---|---|---
`Dict`|`dict`|`Mapping`,`MutableMapping`
`List`|`list`|`Sequence `,`Iterable`
`Tuple`|`tuple`|---
`NamedTuple`|`collections.namedtuple`|---
`Set`|`set`|`AbstractSet`
`FrozenSet`|`frozenset`|`AbstractSet`
`DefaultDict`|`collections.defaultdict`|`Mapping`,`MutableMapping`
`OrderedDict`|`collections.OrderedDict`|`Mapping`,`MutableMapping`
`ChainMap`|`collections.ChainMap`|`Mapping`,`MutableMapping`
`Counter`|`collections.Counter`|`Dict`,`Mapping`,`MutableMapping`
`Deque`|`collections.deque`|`Sequence`,`MutableSequence`

### æŠ½è±¡å®¹å™¨æ¨¡å‹

typingä¸­çš„ç±»å‹|å¯¹åº”å®¹å™¨å·¥å‚å‡½æ•°|ç‰¹æ®Šè¯´æ˜
---|---|---
`AbstractSet`|`collections.abc.Set`|---
`ByteString`|`collections.abc.ByteString`|`bytes`,`bytearray`,`memoryview`ç­‰å­—èŠ‚åºåˆ—ç±»å‹
`Collection`|`collections.abc.Collection`|---
`Container`|`collections.abc.Container`|---
`ItemsView`|`collections.abc.ItemsView`|---
`KeysView`|`collections.abc.KeysView`|---
`Mapping`|`collections.abc.Mapping`|---
`MappingView`|`collections.abc.MappingView`|---
`MutableMapping`|`collections.abc.MutableMapping`|---
`MutableSequence`|`collections.abc.MutableSequence`|---
`MutableSet`|`collections.abc.MutableSet`|---
`Sequence`|`collections.abc.Sequence`|--- 
`ValuesView`|`collections.abc.ValuesView`|---
`Iterable`|`collections.abc.Iterable`|---
`Iterator`|`collections.abc.Iterator`|---
`Generator`|`collections.abc.Generator`|---
`Hashable`|`collections.abc.Hashable`|---
`Reversible`|`collections.abc.Reversible`|---
`Sized`|`collections.abc.Sized`|---


### å…ƒç»„å®¹å™¨çš„å£°æ˜

å…ƒç»„å®¹å™¨çš„å£°æ˜è¯­æ³•æ˜¯`tuple[type,type,...]`å…ƒç»„çš„æ¯ä¸€ä½å¯ä»¥æ˜¯ä¸åŒç±»å‹,å› æ­¤å…ƒç»„æœ‰å‡ ä½å°±éœ€è¦å£°æ˜å‡ºæ¯ä¸€ä½çš„ç±»å‹


```python
test_tuple: tuple[str,int] = ("Tom",10)
```

#### å…·åå…ƒç»„çš„å£°æ˜

`NamedTuple`å¯ä»¥ä½œä¸ºåŸºç±»ç”¨äºå£°æ˜å…·åå…ƒç»„,è¿™æ ·å£°æ˜çš„å…·åå…ƒç»„ä¸ç”¨`collections.namedtuple`æ„é€ çš„ä¸€æ ·,è€Œä¸”å¯ä»¥åŒ…å«å£°æ˜ä¿¡æ¯.ç”¨çš„æ—¶å€™ç±»ä¼¼ç±»å®ä¾‹åŒ–


```python
from typing import NamedTuple
class Student(NamedTuple):
    name: str
    age: int
        
s1:Student
s1 = Student(name="Tom",age=10)
```

å¦ä¸€ç§ç®€ä¾¿å£°æ˜æ–¹å¼æ˜¯ç›´æ¥ä½¿ç”¨`NamedTuple`çš„`__call__`æ–¹æ³•,å…¶å½¢å¼ä¸º`å˜é‡å = NamedTuple(å…·åå…ƒç»„å, [(å­—æ®µå, å­—æ®µç±»å‹),...])`


```python
Employee = NamedTuple('Employee', [('name', str), ('id', int)])
e1:Employee
e1 = Employee(name="Tom",id=10)
```

### æ˜ å°„å®¹å™¨çš„å£°æ˜

æ˜ å°„å‹å®¹å™¨çš„å£°æ˜å½¢å¼ä¸º`å®¹å™¨ç±»å‹[é”®å…ƒç´ ç±»å‹,å€¼å…ƒç´ ç±»å‹]`,pythonä¸­é»˜è®¤åªèƒ½å£°æ˜åŒæ„æ˜ å°„,å³å®¹å™¨ä¸ºç»Ÿä¸€ç±»å‹æè¿°çš„åºåˆ—,å½“ç„¶äº†æˆ‘ä»¬å¯ä»¥ç”¨`Union`æˆ–è€…`Optional`ä¿®é¥°å…ƒç´ ç±»å‹æˆ–è€…ç›´æ¥ç”¨`Any`æ”¾æ¾æ ¡éªŒè¦æ±‚ä»è€Œè¾¾åˆ°å…¼å®¹å¼‚æ„æ˜ å°„çš„ç›®çš„.

æ˜ å°„å®¹å™¨æœ€å¸¸è§çš„æ˜¯`dict`,ä½†åº”å½“æ³¨æ„,åœ¨å£°æ˜ä¸€äº›ä¸å¤ªä¸¥æ ¼æ¥å£çš„çš„åœºåˆ,æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨`Mapping`.


```python
from typing import Mapping

mp1:Mapping[str,int] = {"a":1,"b":2}
mq2:dict[str,int] = {"aa":1,"bb":2}
```

#### é™åˆ¶å­—å…¸å­—æ®µ

åœ¨å®šä¹‰æ¥å£æ—¶ä¸€ç§æƒ…å†µæ˜¯å€¾å‘äºç»™å‡ºå®½æ³›çš„è¦æ±‚,æ¯”å¦‚ä¸€ä¸ªæ¥å£å¯ä»¥ä¼ `dict`,ä¹Ÿå¯ä»¥ä¼ `collections.defaultdict`,é‚£æˆ‘ä»¬å°±åº”è¯¥å£°æ˜å‚æ•°ç±»å‹ä¸º`Mapping`.ä½†ä¸€äº›æ¥å£,å°¤å…¶æ˜¯æ¶‰åŠå¤–éƒ¨ä¼ å‚çš„æ¥å£,æ¯”å¦‚è¯»å–çš„é…ç½®åæ ¹æ®é…ç½®æ‰§è¡Œä¸€äº›æ“ä½œ,é‚£å°±ä¼šæ˜¯å¦ä¸€ç§å€¾å‘,æˆ‘ä»¬ä¼šå¸Œæœ›æŒ‡æ˜å­—å…¸ä¸­æœ‰ç‰¹å®šæˆ‘ä»¬å…³å¿ƒçš„å­—æ®µä»¥åŠå¯¹åº”çš„ç±»å‹.è¿™ç§éœ€æ±‚å¯ä»¥ä½¿ç”¨`TypedDict`å®ç°.



```python
from typing import TypedDict

class Point2D(TypedDict):
    x: int
    y: int
    label: str

p1:Point2D = {"x":0,"y":0,"label":"p1"}
```

å¦ä¸€ç§ç®€ä¾¿å†™æ³•å¦‚ä¸‹:

```python
Point2D = TypedDict('Point2D', {'x': int, 'y': int, 'label': str})
```

è¿™ç§æ–¹å¼éå¸¸é€‚åˆå®šä¹‰ä¸€äº›æœ‰ä¸ç¬¦åˆpythonç±»å­—æ®µå‘½åè¦æ±‚é”®çš„å­—å…¸.

åƒä¸Šé¢è¿™æ ·å®šä¹‰,å‚æ•°å°±å¿…é¡»ä»…åŒ…å«`x`,`y`,`label`è¿™å‡ ä¸ªå­—æ®µ,ä½†æœ‰çš„æ—¶å€™æˆ‘ä»¬å¸Œæœ›å­—æ®µæ˜¯æ›´çµæ´»çš„å½¢å¼,ä¹Ÿå°±æ˜¯

1. å¯ä»¥å­˜åœ¨å¹¶æ²¡æœ‰è¢«å£°æ˜çš„å­—æ®µ
2. ä¸€äº›è¢«å£°æ˜çš„å­—æ®µå¯ä»¥æ²¡æœ‰,ä½†å¦‚æœæœ‰å°±å¿…é¡»æ˜¯æŒ‡å®šç±»å‹

æˆ‘ä»¬å¯ä»¥ç”¨å‚æ•°`total`æ¥å£°æ˜æ˜¯å¦å£°æ˜çš„å­—æ®µå°±æ˜¯å…¨éƒ¨å…è®¸çš„å­—æ®µ

```python
class Point2D(TypedDict,total=False):
    x: int
    y: int
    label: str
```

æˆ–
```python
Point2D = TypedDict('Point2D', {'x': int, 'y': int, 'label': str}, total=False)
```

#### `*`ä½¿ç”¨ä¿®é¥°è¯ä¿®é¥°é™åˆ¶å­—å…¸çš„å­—æ®µ[3.11]

`total`å¯ä»¥è§£å†³å­˜åœ¨å¹¶æ²¡æœ‰è¢«å£°æ˜çš„å­—æ®µçš„å­—æ®µä»¥åŠä¸€äº›è¢«å£°æ˜çš„å­—æ®µå¯ä»¥æ²¡æœ‰çš„é—®é¢˜,ä½†å®ƒå¹¶ä¸èƒ½è§£å†³ç‰¹å®šå­—æ®µå¿…é¡»æœ‰ç‰¹å®šå­—æ®µå¯ä»¥æ²¡æœ‰çš„é—®é¢˜.

åœ¨python 3.11ä¸­æ–°å¢äº†ä¿®é¥°è¯`Required`å’Œ`NotRequired`ç”¨æ¥å£°æ˜æŒ‡å®šå­—æ®µçš„é™åˆ¶

```python
class Point2D(TypedDict,total=False):
    x: Required[int]
    y: Required[int]
    label: NotRequired[str]
```

æˆ–

```python
Point2D = TypedDict('Point2D', {'x': Required[int], 'y': Required[int], 'label': NotRequired[str]}, total=False)
```

éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœ`total`ä¸ºTrue,åˆ™å…¶ä¸­çš„å­—æ®µé»˜è®¤ä¸º`Required`,åä¹‹åˆ™é»˜è®¤ä¸º`NotRequired`

### åºåˆ—å®¹å™¨çš„å£°æ˜

åºåˆ—å®¹å™¨å£°æ˜çš„å½¢å¼ä¸º`å®¹å™¨ç±»å‹[å…ƒç´ ç±»å‹]`,pythonä¸­åªèƒ½å£°æ˜åŒæ„åºåˆ—,å³å®¹å™¨ä¸ºç»Ÿä¸€ç±»å‹æè¿°çš„åºåˆ—,å½“ç„¶äº†æˆ‘ä»¬å¯ä»¥ç”¨`Union`æˆ–è€…`Optional`ä¿®é¥°å…ƒç´ ç±»å‹æˆ–è€…ç›´æ¥ç”¨`Any`æ”¾æ¾æ ¡éªŒè¦æ±‚ä»è€Œè¾¾åˆ°å…¼å®¹å¼‚æ„åºåˆ—çš„ç›®çš„.

åºåˆ—å®¹å™¨æœ€å¸¸ç”¨çš„æ˜¯`List`,ä½†åº”å½“æ³¨æ„,åœ¨å£°æ˜ä¸€äº›ä¸å¤ªä¸¥æ ¼æ¥å£çš„çš„åœºåˆ,æ¯”å¦‚ä½œä¸ºä¸€ä¸ªè¦å’Œæ¯”å¦‚numpyå¯¹æ¥çš„æ¥å£æ—¶,æ¯”è¾ƒå¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨`Sequence`.


```python
from typing import Sequence

sq1:Sequence[int] = [1,2,3,4,5]
sq2:list[int] = [6,7,8,9,10]
```

## ç”Ÿæˆå™¨çš„å£°æ˜

å¯¹äºç”Ÿæˆå™¨,å®ƒæ»¡è¶³`Generator`,`Iterable`,`Iterator`æ¥å£,å› æ­¤å¯ä»¥æ ¹æ®å®é™…æƒ…å†µå£°æ˜å…¶ç±»å‹,

+ `Generator[YieldType, SendType, ReturnType]`
+ `Iterable[YieldType]`
+ `Iterator[YieldType]`

### ç”Ÿæˆå™¨å‡½æ•°çš„å£°æ˜

ç”Ÿæˆå™¨å‡½æ•°ä¸€èˆ¬æŒ‡è¢«è°ƒç”¨åè¿”å›å€¼æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨çš„å‡½æ•°,å…¶å£°æ˜å½¢å¼å¦‚ä¸‹:


```python
from typing import Generator

def my_generator_func(param1: int, param2: str) -> Generator[int, str, None]:
    # å‡½æ•°ä½“é€»è¾‘
    for i in range(param1):
        yield f'{param2} {i}'

# ä½¿ç”¨ç”Ÿæˆå™¨å‡½æ•°
gen:Generator[int, str, None] = my_generator_func(5, 'Hello')

for item in gen:
    print(item)
```

    Hello 0
    Hello 1
    Hello 2
    Hello 3
    Hello 4


## ä¸Šä¸‹æ–‡ç®¡ç†å™¨å£°æ˜

å¯¹äºä¸Šä¸‹æ–‡ç®¡ç†å™¨`contextlib.AbstractContextManager`,å¯ä»¥ä½¿ç”¨`ContextManager`æ¥å£°æ˜,å®ƒæ˜¯ä¸€ä¸ªæ³›å‹ç±»,éœ€è¦æŒ‡å®šç±»å‹,ä¸”è¢«æŒ‡å®šçš„ç±»å‹å¿…é¡»æ˜¯æ»¡è¶³ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„æ¥å£è¦æ±‚çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç±»:

```python
from typing import ContextManager
class MyContextManager:
    def __enter__(self):
        # è·å–èµ„æºçš„é€»è¾‘
        # è¿”å›èµ„æºå¯¹è±¡
        pass

    def __exit__(self, exc_type, exc_value, traceback):
        pass
    
my_manager: ContextManager[MyContextManager] = MyContextManager()
    
```

å½“ç”¨äºå£°æ˜ç”±`@contextlib.contextmanager`è£…é¥°å™¨æ„é€ çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°æ—¶`ContextManager`ä¸­çš„å‚æ•°åˆ™æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°ä¸­`yied`å‡ºæ¥çš„å¯¹è±¡çš„ç±»å‹

```python
from typing import ContextManager
from contextlib import contextmanager

@contextmanager
def my_context_manager():
    # åœ¨è¿›å…¥ä¸Šä¸‹æ–‡ä¹‹å‰çš„é€»è¾‘

    try:
        # è·å–èµ„æºçš„é€»è¾‘
        resource = ...  # èµ„æºå¯¹è±¡
        yield resource
    finally:
        # é‡Šæ”¾èµ„æºçš„é€»è¾‘

# å£°æ˜ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç±»å‹
my_manager: ContextManager[<èµ„æºç±»å‹>] = my_context_manager()
```

### ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°

è¿™æ˜¯ä¸Šé¢ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°çš„å£°æ˜æ–¹æ³•:

```python
@contextmanager
def my_context_manager()->ContextManager[<èµ„æºç±»å‹>]:
    # åœ¨è¿›å…¥ä¸Šä¸‹æ–‡ä¹‹å‰çš„é€»è¾‘

    try:
        # è·å–èµ„æºçš„é€»è¾‘
        resource = ...  # èµ„æºå¯¹è±¡
        yield resource
    finally:
        # é‡Šæ”¾èµ„æºçš„é€»è¾‘
```

## åç¨‹ç±»å‹çš„ç”³æ˜

åç¨‹ç±»å‹ä½¿ç”¨`Coroutine`æˆ–`collections.abc.Coroutine`è¿›è¡Œå£°æ˜,å…¶å½¢å¼ä¸º`Coroutine[YieldType, SendType, ReturnType]`

```python
from collections.abc import Coroutine
c: Coroutine[list[str], str, int]  # Some coroutine defined elsewhere
x = c.send('hi')                   # Inferred type of 'x' is list[str]
async def bar() -> None:
    y = await c  
```

### å¼‚æ­¥å‡½æ•°

ä¸€ä¸ªå…¸å‹çš„å¼‚æ­¥å‡½æ•°å¦‚ä¸‹:


```python
from typing import Any
from collections.abc import Coroutine
async def format_string(tag: str, count: int) -> str:
    return f'T-minus {count} ({tag})'

my_coroutine:Coroutine[Any, Any, str] = format_string("Millennium Falcon", 5)
await my_coroutine
```




    'T-minus 5 (Millennium Falcon)'



å¸¸è§çš„å¼‚æ­¥å‡½æ•°æ˜¯ä¸ç®¡`YieldType`å’Œ `SendType`çš„

## å¼‚æ­¥è¿­ä»£å™¨å£°æ˜

`AsyncIterator`æ˜¯ä¸€ä¸ªä¸“ç”¨äºå£°æ˜ä¸€æ­¥è¿­ä»£å™¨çš„æ³›å‹ç±»,ä½¿ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šå®ƒæ¯æ­¥æŠ›å‡ºçš„æ•°æ®ç±»å‹


```python
from typing import Optional, AsyncIterator
import asyncio

class arange(AsyncIterator[int]):
    def __init__(self, start: int, stop: int, step: int) -> None:
        self.start = start
        self.stop = stop
        self.step = step
        self.count = start - step

    def __aiter__(self) -> AsyncIterator[int]:
        return self

    async def __anext__(self) -> int:
        self.count += self.step
        if self.count == self.stop:
            raise StopAsyncIteration
        else:
            return self.count
async def countdown(tag: str, n: int) -> str:
    async for i in arange(n, 0, -1):
        print(f'T-minus {i} ({tag})')
        await asyncio.sleep(0.1)
    return "Blastoff!"
```


```python
await countdown("tagtest",5)
```

    T-minus 5 (tagtest)
    T-minus 4 (tagtest)
    T-minus 3 (tagtest)
    T-minus 2 (tagtest)
    T-minus 1 (tagtest)





    'Blastoff!'



## å£°æ˜å¼‚æ­¥ç”Ÿæˆå™¨

å¼‚æ­¥ç”Ÿæˆå™¨`AsyncGenerator`æˆ–è€…`collections.abc.AsyncGenerator`ä½¿ç”¨`AsyncGenerator[YieldType, SendType]`çš„å½¢å¼,éœ€è¦æ³¨æ„å¼‚æ­¥ç”Ÿæˆå™¨æ²¡æœ‰è¿”å›å€¼,æ‰€ä»¥å½¢å¼å’Œæ™®é€šç”Ÿæˆå™¨ä¸åŒ.

```python
from collections.abc import AsyncGenerator
ag: AsyncGenerator[int, float]
```

### å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°å£°æ˜

è°ƒç”¨äº§ç”Ÿå¼‚æ­¥ç”Ÿæˆå™¨çš„å‡½æ•°å°±æ˜¯å¼‚æ­¥ç”Ÿæˆå™¨å‡½æ•°,å®ƒçš„è¿”å›å€¼æ˜¯å¼‚æ­¥ç”Ÿæˆå™¨


```python
from collections.abc import AsyncGenerator

async def infinite_stream(start: int) -> AsyncGenerator[int, None]:
    while True:
        yield start
        start = await increment(start)
```

## å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨

ç±»ä¼¼æ™®é€šä¸Šä¸‹æ–‡ç®¡ç†å™¨,å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨`AsyncContextManager`æˆ–è€…`contextlib.AbstractAsyncContextManager`ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ç±»,å®ƒéœ€è¦æŒ‡å®šèµ„æºç±»å‹æ¥ç¡®å®š.

```python
from contextlib import AbstractAsyncContextManager

class MyAsyncContextManager:
    async def __aenter__(self):
        # è·å–èµ„æºçš„é€»è¾‘
        # è¿”å›èµ„æºå¯¹è±¡
        pass

    async def __aexit__(self, exc_type, exc_value, traceback):
        pass
    
my_manager: AbstractAsyncContextManager[MyAsyncContextManager] = MyAsyncContextManager()
    
```

å½“ç”¨äºå£°æ˜ç”±`@contextlib.asynccontextmanager`è£…é¥°å™¨æ„é€ çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°æ—¶`AsyncContextManager`ä¸­çš„å‚æ•°åˆ™æ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°ä¸­`yied`å‡ºæ¥çš„å¯¹è±¡çš„ç±»å‹

```python
from contextlib import AbstractAsyncContextManager,asynccontextmanager

@asynccontextmanager
async def my_async_context_manager():
    # åœ¨è¿›å…¥ä¸Šä¸‹æ–‡ä¹‹å‰çš„é€»è¾‘
    try:
        # è·å–èµ„æºçš„é€»è¾‘
        resource = ...  # èµ„æºå¯¹è±¡
        yield resource
    finally:
        # é‡Šæ”¾èµ„æºçš„é€»è¾‘

# å£°æ˜ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„ç±»å‹
my_manager: AbstractAsyncContextManager[<èµ„æºç±»å‹>] = my_async_context_manager()
```

### å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°

è¿™æ˜¯ä¸Šé¢å¼‚æ­¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨å‡½æ•°çš„å£°æ˜æ–¹æ³•:

```python
@contextmanager
def my_context_manager()->AbstractAsyncContextManager[<èµ„æºç±»å‹>]:
    # åœ¨è¿›å…¥ä¸Šä¸‹æ–‡ä¹‹å‰çš„é€»è¾‘

    try:
        # è·å–èµ„æºçš„é€»è¾‘
        resource = ...  # èµ„æºå¯¹è±¡
        yield resource
    finally:
        # é‡Šæ”¾èµ„æºçš„é€»è¾‘
```

## å¯è°ƒç”¨ç±»å‹çš„ç”³æ˜

å¯è°ƒç”¨ç±»å‹æ³›æŒ‡é‚£äº›å¯ä»¥è¢«è°ƒç”¨çš„ç±»å‹,å‡½æ•°,æ–¹æ³•,lambda,æœ‰`__call__`æ–¹æ³•çš„ç±»å®ä¾‹éƒ½å¯ä»¥ç”¨å¯è°ƒç”¨ç±»å‹æ¥æè¿°.

å…¶å½¢å¼ä¸º`Callable[[å‚æ•°1,å‚æ•°2],è¿”å›]`.å¦‚æœå‚æ•°ä¸ºä¸å®šå‚æ•°,å¯ä»¥ä½¿ç”¨`...`è¡¨ç¤º,å¦‚æœå‚æ•°ä¸ºç©º,å¯ä»¥ç”¨`[]`è¡¨ç¤º,å¦‚æœè¿”å›å€¼ä¸ºç©º,å¯ä»¥ä½¿ç”¨`None`è¡¨ç¤º.


```python
from typing import Callable

def feeder(get_next_item: Callable[[], str]) -> None:
    pass

def async_query(on_success: Callable[[int], None],
                on_error: Callable[[int, Exception], None]) -> None:
    pass
```

### Callableä¸­å‚æ•°`*args,**kwargs`çš„å£°æ˜

ä¸å®šå‚æ•°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`...`è¡¨ç¤º,ä½†è¿™ç§æ–¹å¼æœ‰ç‚¹æŠ½è±¡,å¦‚æœå‚æ•°åªä¸º`*args,**kwargs`å°±å¯ä»¥ä½¿ç”¨å‚æ•°è§„èŒƒå˜é‡`ParamSpec`å£°æ˜ä¸€ä¸ªå‡½æ•°çš„å‚æ•°,å°±åƒä¸‹é¢è¿™æ ·:


```python
from collections.abc import Callable
from typing import ParamSpec
import logging

P = ParamSpec('P')

def testParamSpec(f: Callable[P, str],*args: P.args, **kwargs: P.kwargs) -> str:
    return f(*args,**kwargs)

```


```python
testParamSpec(lambda x: f"echo {str(x)}","hello")
```




    'echo hello'



éœ€è¦æ³¨æ„ParamSpecçš„å®ä¾‹ä¸æ˜¯Callableå‚æ•°ä½ç½®ä¸­å¡«å†™çš„ç±»å‹,è€Œæ˜¯å‚æ•°ä½ç½®æœ¬èº«.

### Callableä¸­å«`*args,**kwargs`çš„å‚æ•°å£°æ˜

ä¸€äº›æƒ…å†µæˆ‘ä»¬å¯èƒ½éœ€è¦æè¿°çš„å¯è°ƒç”¨å¯¹è±¡é™¤äº†æœ‰ä¸å®šå‚æ•°`*args,**kwargs`,ä¹Ÿæœ‰ä¸€äº›æŒ‡å®šäº†çš„å‡½æ•°.è¿™ç§æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨`Concatenate`å°†æ­£å¸¸å‚æ•°ç±»å‹å’Œå‚æ•°è§„èŒƒå˜é‡è¿›è¡Œè¿æ¥


```python
from collections.abc import Callable
from typing import ParamSpec, Concatenate, Any
import logging

P = ParamSpec('P')

def testConcatenate(f: Callable[Concatenate[int,str,P], str],*args: P.args, **kwargs: P.kwargs) -> str:
    return f(1,"Concatenate",*args,**kwargs)
```


```python
testConcatenate(lambda a,b,*args,**kwargs: f"echo a: {a} b:{b},args:{args}","hello")
```




    "echo a: 1 b:Concatenate,args:('hello',)"



### è£…é¥°å™¨å£°æ˜

è£…é¥°å™¨ä½œä¸ºä¸€ç±»ä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°ä¸”è¿”å›å‡½æ•°çš„å‡½æ•°å¯ä»¥å¤§é‡çš„ä½¿ç”¨åˆ°`ParamSpec`å’Œ`Concatenate`,æ¯”å¦‚ä¸‹é¢:


```python
from collections.abc import Callable
from threading import Lock
from typing import Concatenate, ParamSpec, TypeVar

P = ParamSpec('P')
R = TypeVar('R')

# Use this lock to ensure that only one thread is executing a function
# at any time.
my_lock = Lock()

def with_lock(f: Callable[Concatenate[Lock, P], R]) -> Callable[P, R]:
    '''A type-safe decorator which provides a lock.'''
    def inner(*args: P.args, **kwargs: P.kwargs) -> R:
        # Provide the lock as the first argument.
        return f(my_lock, *args, **kwargs)
    return inner

@with_lock
def sum_threadsafe(lock: Lock, numbers: list[float]) -> float:
    '''Add a list of numbers together in a thread-safe manner.'''
    with lock:
        return sum(numbers)

# We don't need to pass in the lock ourselves thanks to the decorator.
sum_threadsafe([1.1, 2.2, 3.3])
```




    6.6



## ç±»å‹åˆ«å

ä¸€äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›ç»™ç‰¹å®šç±»å‹ä¸€ä¸ªåˆ«åä»¥æ˜ç¡®å…¶å«ä¹‰,è¿™æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨


```python
Url = str
def retry(url: Url, retry_count: int) -> None:
    pass
```

æ›´åŠ æ¨èçš„æ˜¯ä½¿ç”¨`TypeAlias`æ˜¾å¼çš„å£°æ˜


```python
from typing import TypeAlias
factors: TypeAlias = list[int]
```

## æ–°ç±»å‹

ç±»å‹åˆ«åæ¯•ç«Ÿåªæ˜¯åˆ«å,æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­,åœ¨urlå‚æ•°ä¸­ç›´æ¥å¡«ä¸€ä¸ªstrç±»å‹çš„æ•°æ®ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜,ä¸€äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›æ›´åŠ æ˜ç¡®çš„å£°æ˜ä¸€ä¸ªæ–°ç±»å‹ä»¥é¿å…å‡½æ•°åœ¨è°ƒç”¨æ—¶è¢«ä¼ å…¥æ—§ç±»å‹,è¿™ç§æ—¶å€™å°±å¯ä»¥ä½¿ç”¨`NewType`æ¥å®ç°.æ³¨æ„`NewType`ä»…æ˜¯ä¸€ä¸ªå£°æ˜,åªä¼šåœ¨ç±»å‹æ£€éªŒæ—¶æœ‰æ•ˆ,è¿è¡Œæ—¶å’Œåˆ«åè¡Œä¸ºä¸€è‡´.



```python
from typing import NewType

UserId = NewType('UserId', int)
some_id = UserId(524313)
```


```python
def get_user_name(user_id: UserId) -> str:
    return str(user_id)
```

## `*`è‡ªå®šä¹‰æ³›å‹æ³¨è§£


ç±»å‹æ³¨é‡Šå¯ä»¥ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ç±»å’Œè‡ªå·±å®šä¹‰çš„ç±»,ä½†å¯¹äºæ³›å‹æ³¨è§£å°±åŠ›ä¸ä»å¿ƒäº†,å¯¹äºè¿™ç§éœ€æ±‚,pythonå†…ç½®äº†typingæ¨¡å—æ¥å¸®åŠ©æ³›å‹æ³¨é‡Š

### æ³›å‹

ç”¨è¿‡å¼ºç±»å‹ç¼–ç¨‹è¯­è¨€çš„éƒ½åº”è¯¥çŸ¥é“æ³›å‹,æ³›å‹æŒ‡çš„æ˜¯ä¸€ä¸ªæè¿°ç±»å‹çš„ç±»å‹,é€šå¸¸æ³›å‹æ˜¯å’Œå¤šæ€ä¸€èµ·çš„,æ³›å‹æ˜¯å¤šæ€çš„ä¸€ä¸ªå®ç°æ–¹å¼.pythonå¤©ç„¶å¤šæ€,æ³›å‹å°±ä¼¼ä¹æœ‰ç‚¹è„±è£¤å­æ”¾å±äº†.ä½†ä¹Ÿä¸æ˜¯å…¨æ— ç”¨å¤„,å®ƒèµ·ç å¯ä»¥åœ¨åŒä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­æ˜ç¡®ç±»å‹ä¸å˜.æ¯”å¦‚æˆ‘ä»¬æƒ³å£°æ˜ä¸€ä¸ªä»åºåˆ—ä¸­æ‰¾å‡ºç¬¬ä¸€ä¸ªitemçš„å‡½æ•°,è¿™æ—¶å€™å°±å¯ä»¥åƒä¸‹é¢è¿™æ ·å£°æ˜:


```python
from typing import Sequence, TypeVar

T = TypeVar('T')      # Declare type variable

def first(l: Sequence[T]) -> T:   # Generic function
    return l[0]
```

### å—é™æ³›å‹

æ³›å‹æ›´å¸¸ç”¨çš„æ–¹æ³•æ˜¯å—é™æ³›å‹,æˆ‘ä»¬å¯ä»¥æ˜ç¡®è¿™ä¸ªæ³›å‹çš„ç±»å‹å¯ä»¥åœ¨ç‰¹å®šçš„ä¸€ä¸ªèŒƒå›´å†….


```python
from typing import TypeVar

AnyStr = TypeVar('AnyStr', str, bytes)#å¿…é¡»æ˜¯stræˆ–è€…bytes

def concat(x: AnyStr, y: AnyStr) -> AnyStr:
    return x + y
```

### ç”¨æˆ·è‡ªå®šä¹‰æ³›å‹ç±»

ç”¨æˆ·å®šä¹‰çš„ç±»å¯ä»¥å®šä¹‰ä¸ºæ³›å‹ç±».


```python
from typing import TypeVar, Generic
from typing import Iterable
class Logger:
    pass

T = TypeVar('T')

class LoggedVar(Generic[T]):
    def __init__(self, value: T, name: str, logger: Logger) -> None:
        self.name = name
        self.logger = logger
        self.value = value

    def set(self, new: T) -> None:
        self.log('Set ' + repr(self.value))
        self.value = new

    def get(self) -> T:
        self.log('Get ' + repr(self.value))
        return self.value

    def log(self, message: str) -> None:
        self.logger.info('{}: {}'.format(self.name,message))
        


def zero_all_vars(vars: Iterable[LoggedVar[int]]) -> None:
    for var in vars:
        var.set(0)
```

å…¶ä¸­ç»§æ‰¿çš„`Generic[T]`è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç±»æ˜¯æ³›å‹ç±»,ä¸”`T`å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°çš„å®šä¹‰ä¸Šä¸‹æ–‡ä¸­è¢«ç»Ÿä¸€.ä½¿ç”¨çš„æ—¶å€™Tå¯ä»¥è¢«æ›¿æ¢ä¸ºå®šä¹‰æ—¶åœˆå®šèŒƒå›´å†…çš„ç±»å‹.

æ³›å‹ç±»éœ€è¦åœ¨ä½¿ç”¨æ—¶å£°æ˜å…¶ä¸­çš„æ³›å‹å…·ä½“æ˜¯ä»€ä¹ˆç±»å‹,æ¯”å¦‚å®šä¹‰å¦‚ä¸‹å‡½æ•°:


```python
from collections.abc import Iterable

def zero_all_vars(vars: Iterable[LoggedVar[int]]) -> None:
    for var in vars:
        var.set(0)
```

`LoggedVar[int]`å°±æ˜ç¡®äº†è¿™ä¸ªå‡½æ•°ä¸­æ³›å‹ç±»ä¸­æ³›å‹çš„ä¸“æŒ‡intç±»å‹.

## `*`åè®®

pythonæ˜¯é¸­å­ç±»å‹,åè®®æ˜¯å…¶é¸­å­ç±»å‹çš„åº•å±‚æ•°æ®æ¨¡å‹,ä¸€äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›é™æ€æ£€æµ‹æŒ‰ç…§åè®®è€Œéç±»å‹è¿è¡Œ,è¿™æ—¶å°±å¯ä»¥ä½¿ç”¨`Protocol`æ¥å®šä¹‰,è¯¥ç‰¹æ€§å¯ä»¥å‚è€ƒ[pep-544](https://peps.python.org/pep-0544/).

ç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥ç»§æ‰¿`Protocol`æ¥è§„å®šä¸€ä¸ªåè®®ç±»,è¿™ä¸ªåè®®ç±»ä¸­å¯ä»¥å®šä¹‰å­—æ®µä¹Ÿå¯ä»¥å®šä¹‰æ–¹æ³•,å½“ä½¿ç”¨è¿™ä¸ªåè®®ç±»ä½œä¸ºçº¦æŸæ—¶é™æ€æ ¡éªŒå™¨å°±ä¼šæ£€æŸ¥å®ä¾‹å¦æœ‰å¯¹åº”çš„å­—æ®µå’Œæ–¹æ³•,ä»è€Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³åè®®.
è¿™ç§ç”¨æ³•æœ‰ç‚¹ç±»ä¼¼goä¸­çš„æ¥å£`interface`çš„è®¾å®š.åè®®æœ¬èº«ä¸å®ç°åŠŸèƒ½,ä»…ä½œä¸ºçº¦å®šå­˜åœ¨.


```python
from typing import Protocol, List, runtime_checkable
from abc import abstractmethod
from typing_extensions import Self

@runtime_checkable
class Template(Protocol):
    name: str        # This is a protocol member
    value: int = 0   # This one too (with default)

    def method_with_implement(self:Self) -> str:
        return "deep blue"
    
    def method_with_pass_implement(self) -> None:
        ...
    @abstractmethod
    def abstractmethod_without_implement(self) -> int:
        return 0
    
```

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`runtime_checkable`è£…é¥°`Protocol`çš„å­ç±»,è¿™æ ·å°±å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨`isinstance()`æ¥æ£€æµ‹å¯¹è±¡æ˜¯å¦ç¬¦åˆåè®®äº†


```python
def test_template(t:Template)->str:
    return t.method_with_implement()
```


```python
isinstance(Template,int)
```




    False



## å¼ºåˆ¶ç±»å‹è½¬æ¢

å¯ä»¥ä½¿ç”¨`cast`å‡½æ•°å¼ºè¡Œå°†ä¸€ä¸ªå¯¹è±¡é‡æ–°å£°æ˜ä¸ºç‰¹å®šç±»å‹


```python
from typing import cast
value = 15
newvalue = cast(NewType,value)
newvalue
```




    15



## é™æ€ç±»å‹æ£€éªŒ

pythonè§£é‡Šå™¨å¹¶ä¸ä¼šåšé™æ€ç±»å‹æ£€éªŒ,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨[mypy](http://mypy-lang.org/)æ¥å®ç°


```python
%%writefile examples/typehints/mypytest.py

from typing import Callable

def twice(i: int, next: Callable[[int], int]) -> int:
    return next(next(i))

def add(i: int) -> str:#å†™æˆè¿”å›str,è¿™æ ·å°±ä¼šæŠ¥é”™!
    return i + 1

print(twice(3, add))   # 5
```

    Overwriting examples/typehints/mypytest.py



```python
!mypy examples/typehints/mypytest.py
```

    examples/typehints/mypytest.py:8: [1m[31merror:[m Incompatible return value type (got [m[1m"int"[m, expected [m[1m"str"[m)  [m[33m[return-value][m
    examples/typehints/mypytest.py:10: [1m[31merror:[m Argument 2 to [m[1m"twice"[m has incompatible type [m[1m"Callable[[int], str]"[m; expected [m[1m"Callable[[int], int]"[m  [m[33m[arg-type][m
    [1m[31mFound 2 errors in 1 file (checked 1 source file)[m


## `*`è¿è¡Œæ—¶ç±»å‹æ£€æµ‹

æ ‡å‡†åº“è‡ªå¸¦çš„typingåªèƒ½ç”¨äºé™æ€æ£€æµ‹,å½“æˆ‘ä»¬éœ€è¦è¿è¡Œæ—¶æ£€æµ‹æ—¶å¯ä»¥å€ŸåŠ©[typeguard](https://github.com/agronholm/typeguard)æ¥å®ç°.`typeguard`ä½¿ç”¨è£…é¥°å™¨è¯­æ³•,
å®ƒæä¾›äº†è£…é¥°å™¨ `@typechecked` ç”¨äºè¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€æµ‹.åŒæ—¶æä¾›äº†å·¥å…·`check_type`æ¥å¯¹å¯¹è±¡çš„ç±»å‹å’ŒæŒ‡å®šå£°æ˜ç±»å‹è¿›è¡Œæ¯”è¾ƒ.
è¿˜æä¾›äº†`install_import_hook`ç”¨äºå…¨å±€æ‰“å¼€è¿è¡Œæ—¶ç±»å‹æ£€æµ‹.

ä¸è¿‡type hintsè®¾è®¡çš„å‡ºå‘ç‚¹å°±æ˜¯é™æ€æ£€éªŒ,è¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€éªŒåŠ¿å¿…ä¼šæ‹‰æ…¢pythonç¨‹åºçš„è¿è¡Œé€Ÿåº¦.pythonæœ¬å°±æ…¢,python 3.11èŠ±äº†ä¸€æ•´ä¸ªç‰ˆæœ¬çš„å¼€å‘æ—¶é—´ä¹Ÿå°±æ•´ä½“æé€Ÿäº†30%,æˆ‘ä»¬å®åœ¨æ˜¯æ²¡æœ‰å¿…è¦åœ¨è¿™ç§åœ°æ–¹æ‹–æ…¢è¿è¡Œæ—¶é—´,å¾—ä¸å¿å¤±.
